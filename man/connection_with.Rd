% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/connection_helpers.R
\name{connection_with}
\alias{connection_with}
\title{Execute code with a managed database connection}
\usage{
connection_with(connection_name, code)
}
\arguments{
\item{connection_name}{Character. Name of the connection in settings.yml}

\item{code}{Expression to evaluate with the connection}
}
\value{
The result of evaluating \code{code}
}
\description{
Provides automatic connection lifecycle management. The connection is
automatically closed when the code block finishes, even if an error occurs.
This prevents connection leaks and ensures proper resource cleanup.
}
\examples{
\dontrun{
# Safe - connection auto-closes
users <- connection_with("my_db", {
  connection_find_by(conn, "users", status = "active")
})

# Multiple operations with same connection
result <- connection_with("my_db", {
  user_id <- connection_insert(conn, "users", list(name = "Alice"))
  connection_insert(conn, "posts", list(user_id = user_id, title = "Hello"))
  user_id
})

# Connection closes even on error
tryCatch(
  connection_with("my_db", {
    stop("Something went wrong")  # Connection still closes
  }),
  error = function(e) message(e$message)
)
}

}
